{% extends "base.html" %}

{% block main %}

  <h2>Modificar subasta</h2> <hr>

  <p>Todos los campos marcados con asterísco (*) son obligatorios.</p>

  <div class="col-md-12">

    <form action="{{ urlFor('modificar-subasta-post') }}" method="POST" class="form-horizontal" enctype="multipart/form-data" role="form">

      <input type="hidden" value="{{ subasta.id }}" name="id">

      <div class="form-group">
        <label for="titulo" class="control-label">Título (*): </label>
        <input type="text" class="form-control" name="titulo" maxlength="120" value="{{ subasta.titulo ? subasta.titulo : '' }}" required>
      </div>

      <!--
      <div class="form-group">
        <label for="uploads">Fotos (*): </label>
        {% if flash.errores.fotos %}
          <ul>
            {% for error in flash.errores.fotos %}
            <li class="text-danger">{{error}}</li>
            {% endfor %}
          </ul>
        {% endif %}
        <input type="file" id="uploads" name="fotos[]" accept="image/*" multiple>
        <div id="uploads-preview">
         
        </div>
      </div>
      -->

      <div class="form-group">
        <label for="descripcion" class="control-label">Descripción (*): </label>
        <textarea class="form-control" name="descripcion" rows="5" required>{{ subasta.descripcion ? subasta.descripcion | trim : '' }}</textarea>
      </div>

      <div class="form-group">
        <label for="id_categoria" class="col-md-2 control-label">Categoria (*): </label>
        <div class="col-md-3">
          <select class="form-control" id="id_categoria" name="id_categoria">
            {% for id, categoria in categorias %}
              {% if flash and subasta.id_categoria == id %}
                <option value="{{ id }}" selected>{{ categoria }}</option>
              {% else %}
                <option value="{{ id }}">{{ categoria }}</option>
              {% endif %}
            {% endfor %}
          </select>
        </div>

        <div class="clearfix"></div><br>

        <label for="duracion" class="col-md-2 control-label">Duracion (*): </label>
        <div class="col-md-3">
          <div class="input-group">
            <input type="number" class="form-control" name="duracion" min="0" max="30" value="{{ subasta.dias ? subasta.dias : '' }}">
            <span class="input-group-addon">días</span>
          </div>
        </div>
      </div>

      <hr>
      
      <div class="form-group">
        <div class="col-md-4">
          <button type="submit" class="btn btn-primary">Modificar</button>
          <a href="{{ urlFor('subasta', {id: subasta.id}) }}" class="btn btn-danger">Cancelar</a>
        </div>
      </div>

    </form>
    
  </div>
  
{% endblock %}

{% block js %}

  <script type="text/javascript">

    $(document).ready(function() {

      $('#uploads').on('change', function (e) {

        var files = e.target.files;
        preview = document.getElementById("uploads-preview");
        preview.innerHTML = '';

        for (var i = 0; i < files.length; i++) {
          var file = files[i];
          var imageType = /image.*/;
          
          if ( ! file.type.match(imageType) ) {
            continue;
          }
          
          var img = document.createElement("img");
          img.file = file;
          preview.appendChild(img);
          
          var reader = new FileReader();
          
          reader.onload = (function(aImg) { return function(e) { aImg.src = e.target.result; }; })(img);
          reader.readAsDataURL(file);
        }
      });

    });

  </script>

{% endblock %}